<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lanza tu idea 0.1 | Sistema de Innovaci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style> 
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Colores Botones */
        .btn-registar { background-color: #16a34a; color: white; } /* Verde */
        .btn-registar:hover { background-color: #15803d; }
        .btn-cancelar { background-color: #dc2626; color: white; } /* Rojo */
        .btn-cancelar:hover { background-color: #b91c1c; }
        .btn-limpiar { background-color: #facc15; color: #854d0e; } /* Amarillo */
        .btn-limpiar:hover { background-color: #eab308; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800 flex flex-col">

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-4">
                    <span class="text-2xl font-black italic text-slate-800 tracking-tighter">Lanza <span class="text-blue-600">tu idea 0.1</span></span>
                    <span class="hidden md:block text-xs font-semibold text-slate-400 border-l-2 border-slate-200 pl-4 uppercase tracking-wide">Dep. Investigaci√≥n Aplicada a la Innovaci√≥n</span>
                </div>
                
                <div class="flex items-center gap-4">
                    <span id="userInfo" class="text-sm font-medium text-slate-500"></span>
                    <button onclick="logout()" id="btnLogout" class="hidden text-xs font-bold text-red-500 hover:text-red-700 uppercase">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </div>
    </nav>

    <div id="viewLogin" class="flex-grow flex items-center justify-center p-4">
        <div class="max-w-md w-full bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
            <div class="bg-blue-600 p-8 text-center">
                <h1 class="text-3xl font-bold text-white mb-2">Bienvenido</h1>
                <p class="text-blue-100">Selecciona tu perfil para ingresar</p>
            </div>
            <div class="p-8 space-y-4">
                <button type="button" onclick="login('ideador')" class="w-full p-4 rounded-xl border-2 border-slate-100 hover:border-blue-500 hover:bg-blue-50 transition-all flex items-center gap-4 group cursor-pointer">
                    <div class="bg-blue-100 p-3 rounded-full text-2xl group-hover:scale-110 transition-transform">üí°</div>
                    <div class="text-left">
                        <h3 class="font-bold text-slate-800">Soy Ideador</h3>
                        <p class="text-xs text-slate-500">Registrar y consultar mis ideas</p>
                    </div>
                </button>
                
                <button type="button" onclick="login('admin')" class="w-full p-4 rounded-xl border-2 border-slate-100 hover:border-sky-500 hover:bg-sky-50 transition-all flex items-center gap-4 group cursor-pointer">
                    <div class="bg-sky-100 p-3 rounded-full text-2xl group-hover:scale-110 transition-transform">üõ°Ô∏è</div>
                    <div class="text-left">
                        <h3 class="font-bold text-slate-800">Soy Administrador</h3>
                        <p class="text-xs text-slate-500">Gestionar, revisar y reportes</p>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <main id="viewIdeador" class="hidden max-w-5xl mx-auto w-full p-6 space-y-6 fade-in">
        
        <div id="ideadorHome" class="space-y-8">
            <div class="text-center py-10">
                <h2 class="text-4xl font-bold text-slate-800 mb-4">¬øTienes una idea innovadora?</h2>
                <p class="text-lg text-slate-600 max-w-2xl mx-auto" id="systemDescription">
                    Este es el sistema oficial para registrar, revisar y clasificar las ideas de innovaci√≥n para su posterior ejecuci√≥n. Tu creatividad impulsa nuestro crecimiento.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-3xl mx-auto">
                <button onclick="navIdeador('formulario')" class="bg-white p-8 rounded-3xl shadow-lg border border-slate-200 hover:shadow-2xl hover:-translate-y-1 transition-all text-center group">
                    <div class="text-6xl mb-6 group-hover:scale-110 transition-transform duration-300">üöÄ</div>
                    <h3 class="text-2xl font-bold text-blue-600 mb-2">Lanza tu idea</h3>
                    <p class="text-slate-500">Accede al formulario para registrar una nueva propuesta.</p>
                </button>
                <button onclick="navIdeador('lista')" class="bg-white p-8 rounded-3xl shadow-lg border border-slate-200 hover:shadow-2xl hover:-translate-y-1 transition-all text-center group">
                    <div class="text-6xl mb-6 group-hover:scale-110 transition-transform duration-300">üìÇ</div>
                    <h3 class="text-2xl font-bold text-slate-700 mb-2">Ideas Lanzadas</h3>
                    <p class="text-slate-500">Consulta el hist√≥rico y estatus de tus ideas registradas.</p>
                </button>
            </div>
        </div>

        <div id="ideadorForm" class="hidden bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 p-6 border-b border-slate-200 flex justify-between items-center">
                <h3 class="text-xl font-bold text-slate-700">üìù Formulario de Registro</h3>
                <button onclick="navIdeador('home')" class="text-sm font-bold text-slate-500 hover:text-blue-600">‚Üê Volver al inicio</button>
            </div>
            <form id="formIdea" class="p-8 space-y-6">
                <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold text-blue-800 uppercase mb-1">No. Empleado <span class="text-red-500">*</span></label>
                            <div class="relative">
                                <input type="text" id="idEmpleado" onkeyup="simularAutocompletado(this.value)" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: 1010" required>
                                <span class="absolute right-3 top-3 text-xs text-slate-400 pointer-events-none">Escribe "1010"</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nombre Completo</label>
                            <input type="text" id="nombreEmpleado" class="w-full p-3 bg-slate-200 border border-slate-300 rounded-xl text-slate-600" readonly>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Correo Electr√≥nico</label>
                            <input type="text" id="correoEmpleado" class="w-full p-3 bg-slate-200 border border-slate-300 rounded-xl text-slate-600" readonly>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Direcci√≥n / Depto</label>
                            <input type="text" id="direccionEmpleado" class="w-full p-3 bg-slate-200 border border-slate-300 rounded-xl text-slate-600" readonly>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Descripci√≥n de la Idea <span class="text-red-500">*</span></label>
                        <textarea id="descIdea" rows="2" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="T√≠tulo corto o resumen de la idea..." required></textarea>
                        <button type="button" onclick="limpiarCampo('descIdea')" class="text-xs text-red-400 hover:text-red-600 mt-1">Borrar campo</button>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Detalle <span class="text-red-500">*</span></label>
                        <textarea id="detalleIdea" rows="5" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="Explica detalladamente en qu√© consiste..." required></textarea>
                        <button type="button" onclick="limpiarCampo('detalleIdea')" class="text-xs text-red-400 hover:text-red-600 mt-1">Borrar campo</button>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row gap-4 pt-4 border-t border-slate-100">
                    <button type="submit" class="btn-registar py-3 px-6 rounded-xl font-bold flex-1 shadow-md transition-transform active:scale-95">
                        Registrar Idea
                    </button>
                    <button type="button" onclick="limpiarFormulario()" class="btn-limpiar py-3 px-6 rounded-xl font-bold flex-1 shadow-md transition-transform active:scale-95">
                        Limpiar Campos
                    </button>
                    <button type="button" onclick="cancelarProceso()" class="btn-cancelar py-3 px-6 rounded-xl font-bold flex-1 shadow-md transition-transform active:scale-95">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>

        <div id="ideadorLista" class="hidden space-y-4">
            <div class="flex justify-between items-end">
                <h3 class="text-2xl font-bold text-slate-800">üìÇ Mis Ideas Lanzadas</h3>
                <div class="space-x-2">
                    <button onclick="navIdeador('formulario')" class="text-blue-600 font-bold text-sm bg-blue-50 px-4 py-2 rounded-lg hover:bg-blue-100">Nueva Idea</button>
                    <button onclick="navIdeador('home')" class="text-slate-500 font-bold text-sm bg-white px-4 py-2 rounded-lg hover:bg-slate-100">Volver Inicio</button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-100 text-slate-500 text-xs uppercase font-bold">
                        <tr>
                            <th class="p-4">ID</th>
                            <th class="p-4">Fecha</th>
                            <th class="p-4">Descripci√≥n</th>
                            <th class="p-4">Estatus</th>
                            <th class="p-4 text-center">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="tablaMisIdeas" class="text-sm divide-y divide-slate-100">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <main id="viewAdmin" class="hidden max-w-7xl mx-auto w-full p-6 space-y-6 fade-in">
        
        <div id="adminDashboard">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800">üìä Dashboard General</h2>
                <div class="flex gap-2">
                    <button onclick="navAdmin('registrar')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-700">Registrar Idea (Manual)</button>
                    <button onclick="navAdmin('inbox')" class="bg-white text-slate-700 border border-slate-300 px-4 py-2 rounded-lg font-bold text-sm hover:bg-slate-50">üì• Ideas Registradas</button>
                    <button onclick="navAdmin('revisadas')" class="bg-white text-slate-700 border border-slate-300 px-4 py-2 rounded-lg font-bold text-sm hover:bg-slate-50">‚úÖ Ideas Revisadas</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-4 rounded-2xl shadow border-l-4 border-blue-500">
                    <p class="text-xs text-slate-500 font-bold uppercase">Total Registradas</p>
                    <p id="kpiTotalIdeas" class="text-3xl font-black text-slate-800">0</p>
                </div>
                <div class="bg-white p-4 rounded-2xl shadow border-l-4 border-yellow-500">
                    <p class="text-xs text-slate-500 font-bold uppercase">Pendientes Revisi√≥n</p>
                    <p id="kpiPendientes" class="text-3xl font-black text-slate-800">0</p>
                </div>
                <div class="bg-white p-4 rounded-2xl shadow border-l-4 border-green-500">
                    <p class="text-xs text-slate-500 font-bold uppercase">Aprobadas/Revisadas</p>
                    <p id="kpiAprobadas" class="text-3xl font-black text-slate-800">0</p>
                </div>
                <div class="bg-white p-4 rounded-2xl shadow border-l-4 border-sky-500">
                    <p class="text-xs text-slate-500 font-bold uppercase">Usuarios Activos</p>
                    <p id="kpiUsuarios" class="text-3xl font-black text-slate-800">0</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow border border-slate-100">
                    <h4 class="font-bold text-slate-700 mb-4">Ideas por Estatus</h4>
                    <canvas id="chartStatus"></canvas>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow border border-slate-100">
                    <h4 class="font-bold text-slate-700 mb-4">Ideas por Clasificaci√≥n</h4>
                    <canvas id="chartClasificacion"></canvas>
                </div>
            </div>
        </div>

        <div id="adminInbox" class="hidden">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navAdmin('dashboard')" class="text-slate-400 hover:text-slate-600">‚Üê Atr√°s</button>
                <h2 class="text-2xl font-bold text-slate-800">üì• Ideas por Revisar</h2>
            </div>
            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-yellow-50 text-yellow-800 text-xs uppercase font-bold border-b border-yellow-100">
                        <tr>
                            <th class="p-4">Fecha</th>
                            <th class="p-4">Empleado</th>
                            <th class="p-4">Descripci√≥n</th>
                            <th class="p-4 text-center">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="tablaInbox" class="text-sm divide-y divide-slate-100"></tbody>
                </table>
            </div>
        </div>

        <div id="adminRevisadas" class="hidden">
             <div class="flex items-center gap-4 mb-6">
                <button onclick="navAdmin('dashboard')" class="text-slate-400 hover:text-slate-600">‚Üê Atr√°s</button>
                <h2 class="text-2xl font-bold text-slate-800">‚úÖ Ideas Revisadas (Hist√≥rico)</h2>
            </div>
             <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-green-50 text-green-800 text-xs uppercase font-bold border-b border-green-100">
                        <tr>
                            <th class="p-4">Fecha</th>
                            <th class="p-4">Nombre</th>
                            <th class="p-4">Descripci√≥n</th>
                            <th class="p-4">Clasificaci√≥n</th>
                            <th class="p-4 text-center">Detalle</th>
                        </tr>
                    </thead>
                    <tbody id="tablaRevisadas" class="text-sm divide-y divide-slate-100"></tbody>
                </table>
            </div>
        </div>

        <div id="adminForm" class="hidden">
            <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden max-w-4xl mx-auto">
                <div class="bg-sky-600 p-6 flex justify-between items-center">
                    <h3 class="text-xl font-bold text-white">Registrar Idea (V√≠a Externa)</h3>
                </div>
                <form id="formAdminManual" class="p-8 space-y-6">
                    <p class="text-sm text-slate-500 bg-slate-100 p-3 rounded-lg border-l-4 border-sky-500 mb-4">
                        Nota: Las ideas registradas aqu√≠ pasar√°n autom√°ticamente al estatus "Revisada".
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">No. Empleado</label>
                            <input type="text" id="adminIdEmp" onkeyup="simularAutocompletadoAdmin(this.value)" class="w-full p-3 border rounded-xl" required>
                        </div>
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Nombre</label><input type="text" id="adminNomEmp" class="w-full p-3 bg-slate-100 rounded-xl" readonly></div>
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Correo</label><input type="text" id="adminMailEmp" class="w-full p-3 bg-slate-100 rounded-xl" readonly></div>
                        <div><label class="text-xs font-bold text-slate-500 uppercase">Direcci√≥n</label><input type="text" id="adminDirEmp" class="w-full p-3 bg-slate-100 rounded-xl" readonly></div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Descripci√≥n</label>
                        <textarea id="adminDesc" rows="2" class="w-full p-3 border rounded-xl" required></textarea>
                        <button type="button" onclick="limpiarCampo('adminDesc')" class="text-xs text-red-400 mt-1">Borrar</button>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Detalle</label>
                        <textarea id="adminDetalle" rows="4" class="w-full p-3 border rounded-xl" required></textarea>
                        <button type="button" onclick="limpiarCampo('adminDetalle')" class="text-xs text-red-400 mt-1">Borrar</button>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-sky-700 uppercase mb-1">V√≠a de Recepci√≥n</label>
                        <select id="adminVia" class="w-full p-3 border rounded-xl bg-white">
                            <option>Correo Electr√≥nico</option>
                            <option>Buz√≥n F√≠sico</option>
                            <option>Reuni√≥n</option>
                            <option>Llamada</option>
                        </select>
                    </div>

                    <div class="flex flex-col md:flex-row gap-4 pt-4 border-t">
                        <button type="submit" class="btn-registar py-3 px-6 rounded-xl font-bold flex-1">Registrar Idea</button>
                        <button type="button" onclick="document.getElementById('formAdminManual').reset()" class="btn-limpiar py-3 px-6 rounded-xl font-bold flex-1">Limpiar Campos</button>
                        <button type="button" onclick="navAdmin('dashboard')" class="btn-cancelar py-3 px-6 rounded-xl font-bold flex-1">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

    </main>

    <div id="modalDetalle" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden animate-slide-up">
            <div class="bg-slate-800 p-4 flex justify-between items-center text-white">
                <h3 class="font-bold">Detalle de la Idea <span id="modalId" class="text-blue-300 ml-2"></span></h3>
                <button onclick="cerrarModal()" class="text-white hover:text-red-400 font-bold text-xl">‚úï</button>
            </div>
            <div class="p-6 space-y-4 max-h-[80vh] overflow-y-auto">
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div><span class="block text-xs font-bold text-slate-400 uppercase">Fecha</span><span id="mFecha" class="font-semibold"></span></div>
                    <div><span class="block text-xs font-bold text-slate-400 uppercase">Usuario</span><span id="mUsuario" class="font-semibold"></span></div>
                </div>
                <div class="bg-slate-50 p-4 rounded-xl border">
                    <span class="block text-xs font-bold text-slate-400 uppercase mb-1">Descripci√≥n</span>
                    <p id="mDesc" class="text-slate-800 font-medium"></p>
                </div>
                <div>
                    <span class="block text-xs font-bold text-slate-400 uppercase mb-1">Detalle Completo</span>
                    <p id="mDetalle" class="text-slate-600 text-sm whitespace-pre-wrap"></p>
                </div>
                
                <div id="adminControls" class="hidden border-t pt-4 mt-4 space-y-4">
                    <h4 class="font-bold text-sky-700 text-sm uppercase">Gesti√≥n Administrativa</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <select id="mAdminClasif" class="p-2 border rounded bg-white text-sm">
                            <option value="" disabled selected>Clasificar como...</option>
                            <option>Mejora de Proceso</option>
                            <option>Nuevo Producto</option>
                            <option>Ahorro de Costos</option>
                            <option>Cultura Organizacional</option>
                        </select>
                        <select id="mAdminStatus" class="p-2 border rounded bg-white text-sm">
                            <option value="Registrada">Registrada (Pendiente)</option>
                            <option value="Revisada">Revisada (Completado)</option>
                            <option value="En Ejecuci√≥n">En Ejecuci√≥n</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-sky-700 uppercase mb-1">Comentario Administrativo</label>
                        <textarea id="mAdminComentario" rows="3" class="w-full p-2 border rounded bg-white text-sm" placeholder="Agrega observaciones internas..."></textarea>
                    </div>

                    <button onclick="guardarRevisionAdmin()" class="w-full bg-sky-600 text-white py-2 rounded-lg font-bold hover:bg-sky-700">Guardar Revisi√≥n</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS SIMULADA ---
        const DB = {
            ideas: [],
            logs: [],
            config: {
                description: "Es un sistema a trav√©s del cual se registran, revisan, clasifican y guardan las ideas de innovaci√≥n para su posterior ejecuci√≥n."
            }
        };

        let currentUser = null; 
        let currentIdeaIdEditing = null;

        // Aseguramos que el DOM cargue antes de ejecutar scripts
        document.addEventListener('DOMContentLoaded', () => {
            initDB();
        });

        // Inicializar con algunos datos dummy
        function initDB() {
            DB.ideas.push({
                id: 'ID-1001',
                fecha: '2025-10-01',
                idEmp: '1010',
                nombre: 'Juan P√©rez',
                correo: 'juan@empresa.com',
                direccion: 'TI',
                desc: 'Automatizar reportes de asistencia',
                detalle: 'Usar Python para leer los logs del reloj biom√©trico...',
                status: 'Revisada',
                clasificacion: 'Mejora de Proceso',
                via: 'Sistema',
                adminComment: 'Aprobado, asignar a equipo de desarrollo.', // Ejemplo de comentario
                history: [{fecha: '2025-10-01', user: 'Juan P√©rez', cambio: 'Creaci√≥n'}]
            });
            DB.ideas.push({
                id: 'ID-1002',
                fecha: new Date().toISOString().split('T')[0],
                idEmp: '2020',
                nombre: 'Maria Gomez',
                correo: 'maria@empresa.com',
                direccion: 'RRHH',
                desc: 'Cafeter√≠a Saludable',
                detalle: 'Incluir opciones vegetarianas en el men√∫ diario.',
                status: 'Registrada',
                clasificacion: '',
                via: 'Sistema',
                adminComment: '',
                history: [{fecha: new Date().toISOString().split('T')[0], user: 'Maria Gomez', cambio: 'Creaci√≥n'}]
            });
        }

        // --- SISTEMA DE LOGIN (FIXED & SECURED VISUALLY) ---
        function login(role) {
            // Caso Ideador: Pase directo
            if (role === 'ideador') {
                ejecutarLogin(role);
                return;
            }

            // Caso Admin: Seguridad
            if (role === 'admin') {
                // Verificar si SweetAlert carg√≥ correctamente
                if (typeof Swal !== 'undefined') {
                    Swal.fire({
                        title: 'Seguridad',
                        input: 'password',
                        inputLabel: 'Ingrese su clave de administrador', 
                        inputPlaceholder: 'Su clave...',
                        confirmButtonText: 'Entrar',
                        confirmButtonColor: '#0ea5e9', // Sky Blue
                        showCancelButton: true,
                        cancelButtonText: 'Cancelar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            if (result.value === '1234') {
                                ejecutarLogin(role);
                            } else {
                                Swal.fire('Error', 'Clave incorrecta', 'error');
                            }
                        }
                    });
                } else {
                    // FALLBACK: Si no hay internet o falla la librer√≠a, usar prompt nativo
                    const pass = prompt("Ingrese clave de administrador:"); 
                    if (pass === '1234') {
                        ejecutarLogin(role);
                    } else if (pass !== null) {
                        alert("Clave incorrecta");
                    }
                }
            }
        }

        function ejecutarLogin(role) {
            currentUser = role;
            document.getElementById('viewLogin').classList.add('hidden');
            document.getElementById('btnLogout').classList.remove('hidden');
            
            if(role === 'ideador') {
                document.getElementById('viewIdeador').classList.remove('hidden');
                document.getElementById('userInfo').innerText = "üë§ Vista Ideador";
                document.getElementById('systemDescription').innerText = DB.config.description;
                navIdeador('home');
            } else {
                document.getElementById('viewAdmin').classList.remove('hidden');
                document.getElementById('userInfo').innerText = "üõ°Ô∏è Vista Administrador";
                navAdmin('dashboard');
            }
        }

        function logout() {
            location.reload();
        }

        function navIdeador(view) {
            ['ideadorHome', 'ideadorForm', 'ideadorLista'].forEach(id => document.getElementById(id).classList.add('hidden'));
            if(view === 'home') document.getElementById('ideadorHome').classList.remove('hidden');
            if(view === 'formulario') {
                document.getElementById('ideadorForm').classList.remove('hidden');
                limpiarFormulario();
            }
            if(view === 'lista') {
                document.getElementById('ideadorLista').classList.remove('hidden');
                renderIdeadorList();
            }
        }

        function navAdmin(view) {
            ['adminDashboard', 'adminInbox', 'adminRevisadas', 'adminForm'].forEach(id => document.getElementById(id).classList.add('hidden'));
            if(view === 'dashboard') {
                document.getElementById('adminDashboard').classList.remove('hidden');
                actualizarKPIs();
                // Peque√±o delay para asegurar que el canvas es visible antes de pintar
                setTimeout(actualizarGraficos, 100);
            }
            if(view === 'inbox') {
                document.getElementById('adminInbox').classList.remove('hidden');
                renderAdminInbox();
            }
            if(view === 'revisadas') {
                document.getElementById('adminRevisadas').classList.remove('hidden');
                renderAdminRevisadas();
            }
            if(view === 'registrar') document.getElementById('adminForm').classList.remove('hidden');
        }

        // --- L√ìGICA DE FORMULARIOS ---
        function simularAutocompletado(valor) {
            if(valor.length >= 4) {
                document.getElementById('nombreEmpleado').value = "Empleado " + valor;
                document.getElementById('correoEmpleado').value = "empleado" + valor + "@empresa.com";
                document.getElementById('direccionEmpleado').value = "Departamento " + valor.charAt(0);
            } else {
                ['nombreEmpleado', 'correoEmpleado', 'direccionEmpleado'].forEach(id => document.getElementById(id).value = '');
            }
        }

        function limpiarCampo(id) {
            document.getElementById(id).value = '';
            document.getElementById(id).focus();
        }

        function limpiarFormulario() {
            document.getElementById('formIdea').reset();
        }

        function cancelarProceso() {
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    title: '¬øCancelar?',
                    text: "Se perder√°n los datos no guardados.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#dc2626',
                    confirmButtonText: 'S√≠, cancelar'
                }).then((result) => {
                    if (result.isConfirmed) navIdeador('home');
                });
            } else {
                if(confirm("¬øCancelar? Se perder√°n los datos.")) navIdeador('home');
            }
        }

        document.getElementById('formIdea').addEventListener('submit', function(e) {
            e.preventDefault();
            const nuevoId = 'ID-' + (1000 + DB.ideas.length + 1);
            
            const nuevaIdea = {
                id: nuevoId,
                fecha: new Date().toISOString().split('T')[0],
                idEmp: document.getElementById('idEmpleado').value,
                nombre: document.getElementById('nombreEmpleado').value,
                correo: document.getElementById('correoEmpleado').value,
                direccion: document.getElementById('direccionEmpleado').value,
                desc: document.getElementById('descIdea').value,
                detalle: document.getElementById('detalleIdea').value,
                status: 'Registrada',
                clasificacion: '',
                via: 'Sistema',
                adminComment: '',
                history: [{
                    fecha: new Date().toISOString(),
                    user: document.getElementById('nombreEmpleado').value,
                    cambio: 'Creaci√≥n de Registro'
                }]
            };

            DB.ideas.push(nuevaIdea);
            
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    title: '¬°Idea Registrada!',
                    text: `Tu idea ha sido guardada con el ID: ${nuevoId}`,
                    icon: 'success',
                    confirmButtonColor: '#16a34a'
                }).then(() => {
                    mostrarDetalle(nuevoId, true); 
                    navIdeador('lista'); 
                });
            } else {
                alert(`¬°Idea Registrada! ID: ${nuevoId}`);
                mostrarDetalle(nuevoId, true);
                navIdeador('lista');
            }
        });

        // --- L√ìGICA DE ADMIN MANUAL ---
        function simularAutocompletadoAdmin(valor) {
            if(valor.length >= 4) {
                document.getElementById('adminNomEmp').value = "Empleado " + valor;
                document.getElementById('adminMailEmp').value = "empleado" + valor + "@empresa.com";
                document.getElementById('adminDirEmp').value = "Departamento " + valor.charAt(0);
            }
        }

        document.getElementById('formAdminManual').addEventListener('submit', function(e) {
            e.preventDefault();
            const nuevoId = 'ID-' + (1000 + DB.ideas.length + 1);
            const adminUser = "Administrador";
            
            const nuevaIdea = {
                id: nuevoId,
                fecha: new Date().toISOString().split('T')[0],
                idEmp: document.getElementById('adminIdEmp').value,
                nombre: document.getElementById('adminNomEmp').value,
                correo: document.getElementById('adminMailEmp').value,
                direccion: document.getElementById('adminDirEmp').value,
                desc: document.getElementById('adminDesc').value,
                detalle: document.getElementById('adminDetalle').value,
                status: 'Revisada', 
                clasificacion: 'Manual Admin',
                via: document.getElementById('adminVia').value,
                adminComment: 'Carga manual',
                history: [{
                    fecha: new Date().toISOString(),
                    user: adminUser,
                    cambio: 'Registro Manual Administrativo'
                }]
            };

            DB.ideas.push(nuevaIdea);
            
            if(typeof Swal !== 'undefined') {
                Swal.fire({ title: 'Registrada', text: 'La idea se guard√≥ con estatus Revisada.', icon: 'success' });
            } else {
                alert('Registrada con √©xito');
            }
            document.getElementById('formAdminManual').reset();
            navAdmin('dashboard');
        });

        // --- RENDERIZADO Y UTILIDADES ---
        function renderIdeadorList() {
            const tbody = document.getElementById('tablaMisIdeas');
            tbody.innerHTML = '';
            DB.ideas.forEach(idea => {
                tbody.innerHTML += `
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-4 font-bold text-slate-600">${idea.id}</td>
                        <td class="p-4 text-slate-500">${idea.fecha}</td>
                        <td class="p-4 font-medium text-slate-800">${idea.desc}</td>
                        <td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold ${getColorStatus(idea.status)}">${idea.status}</span></td>
                        <td class="p-4 text-center"><button onclick="mostrarDetalle('${idea.id}')" class="text-blue-600 hover:text-blue-800">üëÅÔ∏è Ver</button></td>
                    </tr>`;
            });
        }

        function renderAdminInbox() {
            const tbody = document.getElementById('tablaInbox');
            tbody.innerHTML = '';
            const pendientes = DB.ideas.filter(i => i.status === 'Registrada');
            if(pendientes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-slate-400">No hay ideas nuevas pendientes.</td></tr>';
                return;
            }
            pendientes.forEach(idea => {
                tbody.innerHTML += `
                    <tr class="hover:bg-yellow-50 transition-colors">
                        <td class="p-4 text-slate-500">${idea.fecha}</td>
                        <td class="p-4 font-bold text-slate-700">${idea.nombre}</td>
                        <td class="p-4 text-slate-600">${idea.desc}</td>
                        <td class="p-4 text-center"><button onclick="mostrarDetalle('${idea.id}', false, true)" class="bg-blue-600 text-white px-3 py-1 rounded shadow text-xs hover:bg-blue-700">Revisar</button></td>
                    </tr>`;
            });
        }

        function renderAdminRevisadas() {
            const tbody = document.getElementById('tablaRevisadas');
            tbody.innerHTML = '';
            const revisadas = DB.ideas.filter(i => i.status !== 'Registrada');
            revisadas.forEach(idea => {
                tbody.innerHTML += `
                    <tr class="hover:bg-green-50 transition-colors">
                        <td class="p-4 text-slate-500">${idea.fecha}</td>
                        <td class="p-4 font-bold text-slate-700">${idea.nombre}</td>
                        <td class="p-4 text-slate-600">${idea.desc}</td>
                        <td class="p-4 text-xs font-bold text-sky-600">${idea.clasificacion || '-'}</td>
                        <td class="p-4 text-center"><button onclick="mostrarDetalle('${idea.id}', false, true)" class="text-slate-400 hover:text-blue-600">üìù Editar</button></td>
                    </tr>`;
            });
        }

        function getColorStatus(status) {
            if(status === 'Registrada') return 'bg-yellow-100 text-yellow-800';
            if(status === 'Revisada') return 'bg-green-100 text-green-800';
            return 'bg-slate-100 text-slate-800';
        }

        function mostrarDetalle(id, soloLectura = false, modoAdmin = false) {
            const idea = DB.ideas.find(i => i.id === id);
            if(!idea) return;
            currentIdeaIdEditing = id;
            document.getElementById('modalId').innerText = idea.id;
            document.getElementById('mFecha').innerText = idea.fecha;
            document.getElementById('mUsuario').innerText = idea.nombre;
            document.getElementById('mDesc').innerText = idea.desc;
            document.getElementById('mDetalle').innerText = idea.detalle;
            
            const adminPanel = document.getElementById('adminControls');
            if(modoAdmin && currentUser === 'admin') {
                adminPanel.classList.remove('hidden');
                document.getElementById('mAdminClasif').value = idea.clasificacion || "";
                document.getElementById('mAdminStatus').value = idea.status;
                // Cargar comentario existente si lo hay
                document.getElementById('mAdminComentario').value = idea.adminComment || "";
            } else {
                adminPanel.classList.add('hidden');
            }
            document.getElementById('modalDetalle').classList.remove('hidden');
            document.getElementById('modalDetalle').classList.add('flex');
        }

        function cerrarModal() {
            document.getElementById('modalDetalle').classList.add('hidden');
            document.getElementById('modalDetalle').classList.remove('flex');
            currentIdeaIdEditing = null;
        }

        function guardarRevisionAdmin() {
            if(!currentIdeaIdEditing) return;
            const idea = DB.ideas.find(i => i.id === currentIdeaIdEditing);
            const nuevoStatus = document.getElementById('mAdminStatus').value;
            const nuevaClasif = document.getElementById('mAdminClasif').value;
            const nuevoComentario = document.getElementById('mAdminComentario').value;

            idea.status = nuevoStatus;
            idea.clasificacion = nuevaClasif;
            idea.adminComment = nuevoComentario;

            if(typeof Swal !== 'undefined') Swal.fire('Guardado', 'Revisi√≥n actualizada', 'success');
            else alert('Guardado');
            cerrarModal();
            actualizarKPIs();
            renderAdminInbox();
            renderAdminRevisadas();
        }

        // --- DASHBOARD CHARTS ---
        let charts = {};
        function actualizarKPIs() {
            document.getElementById('kpiTotalIdeas').innerText = DB.ideas.length;
            document.getElementById('kpiPendientes').innerText = DB.ideas.filter(i => i.status === 'Registrada').length;
            document.getElementById('kpiAprobadas').innerText = DB.ideas.filter(i => i.status === 'Revisada').length;
            const users = new Set(DB.ideas.map(i => i.nombre));
            document.getElementById('kpiUsuarios').innerText = users.size;
        }

        function actualizarGraficos() {
            const ctxStatus = document.getElementById('chartStatus');
            const ctxClasif = document.getElementById('chartClasificacion');
            if(!ctxStatus || !ctxClasif) return;
            
            // Contamos manualmente
            const countRegistradas = DB.ideas.filter(i => i.status === 'Registrada').length;
            const countRevisadas = DB.ideas.filter(i => i.status === 'Revisada').length;
            const countEjecucion = DB.ideas.filter(i => i.status === 'En Ejecuci√≥n').length;

            const clasifCounts = {};
            DB.ideas.forEach(i => { 
                const c = i.clasificacion || 'Sin Clasificar';
                clasifCounts[c] = (clasifCounts[c] || 0) + 1; 
            });

            if(charts.status) charts.status.destroy();
            if(charts.clasif) charts.clasif.destroy();

            // GR√ÅFICO CIRCULAR:
            // Orden: Revisadas primero, luego Registradas.
            charts.status = new Chart(ctxStatus, {
                type: 'doughnut',
                data: {
                    labels: ['Revisadas', 'Registradas', 'En Ejecuci√≥n'],
                    datasets: [{
                        data: [countRevisadas, countRegistradas, countEjecucion],
                        backgroundColor: ['#22c55e', '#facc15', '#3b82f6'] // Verde, Amarillo, Azul
                    }]
                }
            });

            charts.clasif = new Chart(ctxClasif, {
                type: 'bar',
                data: {
                    labels: Object.keys(clasifCounts),
                    datasets: [{
                        label: 'Cantidad',
                        data: Object.values(clasifCounts),
                        backgroundColor: '#0ea5e9' // Sky Blue
                    }]
                }
            });
        }
    </script>
</body>
</html>
